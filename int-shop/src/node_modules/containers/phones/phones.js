import React, { Component } from 'react'
import { connect } from 'react-redux'

import { 
  fetchAllPhones, 
  loadMorePhones, 
  addPhoneToBasket,
  fetchCategories
} from 'action'

import { getPhones } from 'selectors'
import Phone from 'components/Phone/Phone'
import Layout from 'containers/layout'
import Spinner from 'components/spinner/spinner'

class Phones extends Component {
  componentDidMount() {
    this.props.fetchAllPhones()
    this.props.fetchCategories()
  }

  render() {
    const { phones, loadMorePhones, loading, addPhoneToBasket } = this.props
    // console.log('phones', phones)

    const list = phones.map((phone, index) => (
      <Phone
        phone={phone}
        key={index}
        addPhoneToBasket={addPhoneToBasket}
      />
    ))

    if (loading) {
      return <Spinner />
    }

    return (
      <Layout>
        <div className='books row'>
          {list}
        </div>
        <div className="row">
          <div className="col-md-12">
            <button
              className="btn btn-primary pull-right"
              onClick={loadMorePhones}
            >
              Load More
            </button>
          </div>
        </div>
      </Layout>
    )
  }
}

const mapStateTpProps = (state, ownProps) => {
  return {
    phones: getPhones(state, ownProps),
    loading: state.phonesPage.loading
  }
}

const mapDispatchToProps = {
  fetchAllPhones,
  loadMorePhones,
  addPhoneToBasket,
  fetchCategories
}

export default connect(mapStateTpProps, mapDispatchToProps)(Phones)